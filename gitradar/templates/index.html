{% extends "./base.html" %}

{% block js %}
<link href='//api.tiles.mapbox.com/mapbox.js/v1.5.2/mapbox.css' rel='stylesheet' />
<script src='//api.tiles.mapbox.com/mapbox.js/v1.5.2/mapbox.js'></script>

<script src="{{ static_url("js/csv2geojson.js") }}"></script>
{% end %}

{% block content %}
    <div class="title">Git Radar</div>
    <form method="post" action="">
        <div class="ui massive left icon input mysearch">
            <input type="text" placeholder="Search locations..." id="location" name="location">
            <i class="map marker icon"></i>
        </div>
    </form>
    <a class="index-foot view-map" href="#">View Map</a>


    {% if actors %}
    <ul>
        {% for actor in actors %}
            <li>
                <a href="/report/{{ actor['login'] }}">{{ actor['login'] }}</a>({{ actor.get('name', 'null') }})&nbsp;{{ actor['val'] }}
            </li>
        {% end %}
    </ul>
    {% end %}

  <div class="ui basic modal">
      <i class="close icon"></i>
      <div id="map"></div>
  </div>

{% end %}

{% block js_embed %}
<script type="text/javascript">
    var map = L.mapbox.map('map', 'examples.map-9ijuk24y');
    var markerLayer = L.mapbox.markerLayer().addTo(map);
    $.ajax({
            url: '{{static_url("grcount.csv")}}',
            success: function csvLoad(csv) {
                markerLayer.setGeoJSON(csv2geojson.csv2geojson(csv));
            }
    });
    $(".view-map").click(function(e) {
        e.preventDefault();
        $('.basic.modal').modal("show");
    }) 
</script>
{% end %}
